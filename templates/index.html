{% extends "base.html" %}
{% block content %}
  <section class="card fade-in">
    <h2 class="card-title">Model Inputs</h2>

    {% if errors and errors|length > 0 %}
      <div class="alert slide-down">
        {% for e in errors %}
          <div class="alert-item">• {{ e }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="post" class="grid">
      <div class="field">
        <label>Fruit Mass</label>
        <input type="number" step="any" name="Wp" value="{{ fields.Wp }}" placeholder="kg" required />
        <span class="unit">kg</span>
      </div>

      <div class="field">
        <label>Temperature</label>
        <input type="number" step="any" name="StorageTemperature" value="{{ fields.StorageTemperature }}" placeholder="°C" required />
        <span class="unit">°C</span>
      </div>

      <div class="field">
        <label>Perforation Diameter</label>
        <input type="number" step="any" name="Perforationdiamicron" value="{{ fields.Perforationdiamicron }}" placeholder="µm" required />
        <span class="unit">µm</span>
      </div>

      <div class="field">
        <label>Number of Perforations</label>
        <input type="number" step="1" name="NumberofPerfo" value="{{ fields.NumberofPerfo }}" placeholder="count" required />
        <span class="unit">#</span>
      </div>

      <div class="field">
        <label>Scavenger Mass</label>
        <input type="number" step="any" name="mryan" value="{{ fields.mryan }}" placeholder="g" required />
        <span class="unit">g</span>
      </div>

      <div class="field">
        <label>Package Volume</label>
        <input type="number" step="any" name="Vl" value="{{ fields.Vl }}" placeholder="L" required />
        <span class="unit">L</span>
      </div>

      <div class="field">
        <label>Time</label>
        <input type="number" step="any" name="Test_days" value="{{ fields.Test_days }}" placeholder="days" required />
        <span class="unit">days</span>
      </div>

      <div class="actions">
        <button type="submit" name="update" class="btn primary">Update Plots</button>
        <button type="submit" name="reset" class="btn ghost">Reset</button>
      </div>
    </form>
  </section>

  <section class="plots">
    {% if plot1_b64 or plot2_b64 %}
      <div class="plot-card pop-in">
        <h3>Predicted O₂ & CO₂</h3>
        <img src="data:image/png;base64,{{ plot1_b64 }}" alt="Oxygen and CO₂ plot" />
      </div>

      <div class="plot-card pop-in delay">
        <h3>Predicted C₂H₄</h3>
        <img src="data:image/png;base64,{{ plot2_b64 }}" alt="Ethylene plot" />
      </div>
    {% else %}
      <div class="empty-state">
        <p>Enter inputs and click <strong>Update Plots</strong> to see predictions.</p>
      </div>
    {% endif %}
  </section>

    {% if extra_info and (extra_info.scavenger_done_day is not none or extra_info.rem_scavenger_capacity_ppm is not none) %}
  <section class="card info tilt-in">
    <h2 class="card-title">Scavenger Summary</h2>
    <ul class="kv">
      <li><span>Capacity (qryanmax):</span><b>{{ "%.4f"|format(extra_info.qryanmax_ppm) }} ppm</b></li>
      <li><span>Remaining capacity:</span><b>{{ "%.4f"|format(extra_info.rem_scavenger_capacity_ppm) if extra_info.rem_scavenger_capacity_ppm is not none else "—" }}</b></li>
      <li><span>Capacity finished at (day):</span><b>{{ "%.4f"|format(extra_info.scavenger_done_day) if extra_info.scavenger_done_day is not none else "Not exhausted" }}</b></li>
    </ul>
    <p style="margin-top: 16px; font-size: 0.9em; opacity: 0.8;">
      Based on: Sonawane et al. (2024). 
      <a href="https://doi.org/10.1016/j.postharvbio.2023.112734" target="_blank" style="color: var(--accent);">
        Postharvest Biology and Technology, 209, 112734
      </a>
    </p>
  </section>
  {% endif %}

